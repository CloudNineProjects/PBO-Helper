<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pokémon Utility App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
    }

    h2 {
      margin-top: 0;
    }

    .section {
      border: 1px solid #ccc;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .highlight {
      background-color: #FFE8C6;
    }

    .plain {
      background-color: #fff;
    }

    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 14px;
      margin: 8px 0;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #45a049;
    }

    input, select {
      padding: 6px;
      margin: 6px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100%;
      max-width: 300px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }

    table, th, td {
      border: 1px solid #ccc;
    }

    th, td {
      padding: 6px;
      text-align: left;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="loader">
    <button id="loadButton">Load Data</button>
  </div>

  <div id="app" class="hidden">
    <!-- Pokémon Finder -->
    <div class="section highlight">
      <h2>Pokémon Finder</h2>
      <input type="text" id="pokemonInput" placeholder="Enter Pokémon name">
      <label><input type="checkbox" id="optimizedHunt"> Optimized Hunt</label>
      <button onclick="searchPokemon()">Search</button>
      <div id="pokemonResults"></div>
    </div>

    <!-- Spawn Check -->
    <div class="section plain">
      <h2>Spawn Check</h2>
      <select id="spawnRegion"></select>
      <button onclick="checkSpawns()">Check</button>
      <div id="spawnResults"></div>
    </div>

    <!-- Chest Finder -->
    <div class="section highlight">
      <h2>Chest Finder</h2>
      <select id="chestType"></select>
      <button onclick="findChests()">Find</button>
      <div id="chestResults"></div>
    </div>

    <!-- Mega Stone Check -->
    <div class="section plain">
      <h2>Mega Stone Check</h2>
      <select id="megaStone"></select>
      <button onclick="checkMegaStone()">Check</button>
      <div id="megaStoneResults"></div>
    </div>

    <!-- PvP Check -->
    <div class="section highlight">
      <h2>PvP Check</h2>
      <input type="text" id="pvpInput" placeholder="Enter Pokémon name">
      <button onclick="checkPvp()">Check</button>
      <div id="pvpResults"></div>
    </div>
  </div>

  <script>
    // CSV URLs
    const csvUrls = {
      sinnoh: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3eHdgBkA2DHukT5irO5O38RuYUZ3BDYfM0TCz9LATz0URiiKCSkyKtNFbfQkKR2pEzLbCeMh7saZe/pub?gid=0&single=true&output=csv",
      jvaloh: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3eHdgBkA2DHukT5irO5O38RuYUZ3BDYfM0TCz9LATz0URiiKCSkyKtNFbfQkKR2pEzLbCeMh7saZe/pub?gid=1888700837&single=true&output=csv",
      hoenn: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3eHdgBkA2DHukT5irO5O38RuYUZ3BDYfM0TCz9LATz0URiiKCSkyKtNFbfQkKR2pEzLbCeMh7saZe/pub?gid=1008140095&single=true&output=csv",
      kanto: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3eHdgBkA2DHukT5irO5O38RuYUZ3BDYfM0TCz9LATz0URiiKCSkyKtNFbfQkKR2pEzLbCeMh7saZe/pub?gid=963744340&single=true&output=csv",
      event: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3eHdgBkA2DHukT5irO5O38RuYUZ3BDYfM0TCz9LATz0URiiKCSkyKtNFbfQkKR2pEzLbCeMh7saZe/pub?gid=867555265&single=true&output=csv",
      crew: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3eHdgBkA2DHukT5irO5O38RuYUZ3BDYfM0TCz9LATz0URiiKCSkyKtNFbfQkKR2pEzLbCeMh7saZe/pub?gid=277236296&single=true&output=csv",
      chests: "https://docs.google.com/spreadsheets/d/e/2PACX-1vT9NXQeF7_DUFs-GSpxYU5QsufA6Vtwi_n5O6ytErPYQAssIC4zen99a23uPvYQXzjARPvF0XbXIiOn/pub?output=csv",
      mega: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3eHdgBkA2DHukT5irO5O38RuYUZ3BDYfM0TCz9LATz0URiiKCSkyKtNFbfQkKR2pEzLbCeMh7saZe/pub?gid=1948939192&single=true&output=csv",
      pvp: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3eHdgBkA2DHukT5irO5O38RuYUZ3BDYfM0TCz9LATz0URiiKCSkyKtNFbfQkKR2pEzLbCeMh7saZe/pub?gid=1739171262&single=true&output=csv"
    };

    let data = {};

    async function loadCSV(url) {
      const response = await fetch(url);
      const text = await response.text();
      return text.split("\n").map(r => r.split(","));
    }

    async function loadData() {
      for (const key in csvUrls) {
        data[key] = await loadCSV(csvUrls[key]);
      }

      // Populate dropdowns
      const chestTypes = [...new Set(data.chests.slice(1).map(r => r[0]))];
      document.getElementById("chestType").innerHTML =
        chestTypes.map(t => `<option>${t}</option>`).join("");

      const megaStones = [...new Set(data.mega.slice(1).map(r => r[0]))];
      document.getElementById("megaStone").innerHTML =
        megaStones.map(s => `<option>${s}</option>`).join("");

      const spawnRegions = Object.keys(data).filter(k =>
        ["sinnoh","jvaloh","hoenn","kanto","event","crew"].includes(k)
      );
      document.getElementById("spawnRegion").innerHTML =
        spawnRegions.map(r => `<option>${r}</option>`).join("");

      document.getElementById("loader").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");
    }

    function tableHTML(headers, rows) {
      let html = "<table><tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";
      rows.forEach(r => {
        html += "<tr>" + r.map(c => `<td>${c}</td>`).join("") + "</tr>";
      });
      html += "</table>";
      return html;
    }

    function searchPokemon() {
      const name = document.getElementById("pokemonInput").value.trim().toLowerCase();
      const optimized = document.getElementById("optimizedHunt").checked;
      let results = [];

      ["sinnoh","jvaloh","hoenn","kanto","event","crew"].forEach(region => {
        const sheet = data[region];
        const headers = sheet[0];
        const rows = sheet.slice(1).filter(r => r[2]?.toLowerCase() === name);
        if (rows.length) {
          if (optimized) {
            const filtered = rows.filter(r => {
              const location = r[1];
              const method = r[5];
              const others = sheet.slice(1).filter(o => o[1] === location && o[3] === "Ultra Rare" && o[5] === method);
              return others.length > 0;
            });
            results.push(...filtered.map(r => [region,...r]));
          } else {
            results.push(...rows.map(r => [region,...r]));
          }
        }
      });

      // also check chests
      data.chests.slice(1).forEach(r => {
        if (r[2]?.toLowerCase() === name) {
          results.push(["chests", ...r]);
        }
      });

      document.getElementById("pokemonResults").innerHTML =
        results.length ? tableHTML(["Region", ...data.sinnoh[0]], results) : "No results.";
    }

    function checkSpawns() {
      const region = document.getElementById("spawnRegion").value;
      document.getElementById("spawnResults").innerHTML =
        tableHTML(data[region][0], data[region].slice(1));
    }

    function findChests() {
      const type = document.getElementById("chestType").value;
      const rows = data.chests.slice(1).filter(r => r[0] === type);
      document.getElementById("chestResults").innerHTML =
        tableHTML(data.chests[0], rows);
    }

    function checkMegaStone() {
      const stone = document.getElementById("megaStone").value;
      const rows = data.mega.slice(1).filter(r => r[0] === stone);
      document.getElementById("megaStoneResults").innerHTML =
        tableHTML(data.mega[0], rows);
    }

    function checkPvp() {
      const name = document.getElementById("pvpInput").value.trim().toLowerCase();
      const rows = data.pvp.slice(1).filter(r => r[0]?.toLowerCase() === name);
      document.getElementById("pvpResults").innerHTML =
        rows.length ? tableHTML(data.pvp[0], rows) : "Currently not listed on the ban list.";
    }

    document.getElementById("loadButton").addEventListener("click", loadData);
  </script>
</body>
</html>
